<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        (function () {
            try {
                var theme = localStorage.getItem("theme");
                if (!theme) {
                    theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
                }
                document.documentElement.classList.add(theme);
            } catch {
                document.documentElement.classList.add("light");
            }
        })();
    </script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shadowrun GM</title>
    <base href="/" />

    <!-- Fonts (Inter + Roboto to match your theme fallback) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />

    <!-- MudBlazor CSS (bump v= when you upgrade MudBlazor) -->
    <link href="_content/MudBlazor/MudBlazor.min.css?v=8110" rel="stylesheet" />

    <link href="_content/MudBlazor.Markdown/MudBlazor.Markdown.min.css" rel="stylesheet" />

    <link href="ShadowrunGM.UI.styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/app.css?v=8110" />
    <link rel="icon" type="image/png" href="favicon.png" />

    <!-- PWA -->
    <link id="pwa-manifest" rel="manifest" href="manifest-light.webmanifest">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="Shadowrun GM â€” a modern web GM screen for planning and running missions.">
    <meta name="color-scheme" content="light dark">

    <!-- System theme colors for status bar tint -->
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#F9FAFB">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#111827">
</head>
<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%"></circle>
            <circle r="40%" cx="50%" cy="50%"></circle>
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">ðŸ—™</span>
    </div>

    <script src="theme.js"></script>
    <script src="sw-updates.js"></script>
    <script src="_framework/blazor.webassembly.js"></script>

    <!-- MudBlazor JS (bump v= when you upgrade; defer is safe) -->
    <script src="_content/MudBlazor/MudBlazor.min.js?v=8110" defer></script>

    <script src="_content/MudBlazor.Markdown/MudBlazor.Markdown.min.js"></script>

    <!-- Service worker registration -->
    <script>
        if ('serviceWorker' in navigator) {
            // In dev youâ€™re using service-worker.js; in publish the build will swap to service-worker.published.js
            navigator.serviceWorker.register('service-worker.js');

            // Optional: promptless reload when a new version activates
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                // Reload once when the new SW takes control
                if (!window.__reloaded) {
                    window.__reloaded = true;
                    window.location.reload();
                }
            });
        }
    </script>
    <script>
        (function () {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
            const link = document.getElementById('pwa-manifest');

            function apply() {
                link.setAttribute('href', prefersDark.matches
                    ? 'manifest-dark.webmanifest'
                    : 'manifest-light.webmanifest');
            }
            apply();
            prefersDark.addEventListener('change', apply);
        })();
    </script>
</body>
</html>